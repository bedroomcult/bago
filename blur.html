<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>sblur Web (Tailwind)</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800 p-4">
  <div class="max-w-5xl mx-auto">
    <h1 class="text-2xl font-bold mb-6 text-center">sblur Web</h1>

    <!-- Controls -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Canvas Width</label>
        <input type="number" id="width" value="900"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Canvas Height</label>
        <input type="number" id="height" value="1600"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">DPI</label>
        <input type="number" id="dpi" value="300"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Background Color</label>
        <input type="color" id="bgColor" value="#ffffff"
          class="w-full h-10 border rounded-lg mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Margin (px)</label>
        <input type="number" id="margin" value="100"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Corner Radius (px)</label>
        <input type="number" id="radius" value="25"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Shadow Offset (px)</label>
        <input type="number" id="shadowOffset" value="12"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Shadow Blur (px)</label>
        <input type="number" id="shadowBlur" value="12"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Shadow Opacity (0â€“1)</label>
        <input type="number" step="0.1" id="shadowOpacity" value="0.4"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Blur Strength (BG)</label>
        <input type="number" id="blurStrength" value="25"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow">
        <label class="block text-sm font-medium">Brightness Factor (BG)</label>
        <input type="number" step="0.1" id="brightnessFactor" value="0.5"
          class="w-full border rounded-lg p-2 mt-1">
      </div>
      <div class="bg-white p-4 rounded-xl shadow flex items-center space-x-2">
        <input type="checkbox" id="useBg" class="h-4 w-4">
        <label for="useBg" class="text-sm font-medium">Use image as background</label>
      </div>
    </div>

    <!-- File input -->
    <div class="flex flex-col items-center mb-6">
      <input type="file" id="fileInput" multiple accept="image/*"
        class="mb-3 text-sm">
      <button onclick="processAll()"
        class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg shadow">
        Process Images
      </button>
    </div>

    <!-- Preview -->
    <div id="preview" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>

    <canvas id="canvas" class="hidden"></canvas>
  </div>

  <script>
    async function processImage(file, settings) {
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = () => {
          const img = new Image();
          img.onload = () => {
            const canvas = document.getElementById("canvas");
            const ctx = canvas.getContext("2d");
            const {width, height, margin, radius,
                   shadowOffset, shadowBlur, shadowOpacity,
                   useBg, bgColor, blurStrength, brightnessFactor} = settings;

            canvas.width = width;
            canvas.height = height;

            // --- Background ---
            if (useBg) {
              ctx.drawImage(img, 0, 0, width, height);
              ctx.filter = `blur(${blurStrength}px) brightness(${brightnessFactor})`;
              ctx.drawImage(canvas, 0, 0);
              ctx.filter = "none";
            } else {
              ctx.fillStyle = bgColor;
              ctx.fillRect(0, 0, width, height);
            }

            // --- Foreground scaling ---
            const maxW = width - margin * 2;
            const maxH = height - margin * 2;
            let scale = Math.min(maxW / img.width, maxH / img.height);
            let fw = img.width * scale;
            let fh = img.height * scale;
            let fx = (width - fw) / 2;
            let fy = (height - fh) / 2;

            // --- Shadow + Rounded corners ---
            ctx.save();
            ctx.shadowOffsetX = shadowOffset;
            ctx.shadowOffsetY = shadowOffset;
            ctx.shadowBlur = shadowBlur;
            ctx.shadowColor = `rgba(0,0,0,${shadowOpacity})`;

            ctx.beginPath();
            const r = radius;
            ctx.moveTo(fx + r, fy);
            ctx.lineTo(fx + fw - r, fy);
            ctx.quadraticCurveTo(fx + fw, fy, fx + fw, fy + r);
            ctx.lineTo(fx + fw, fy + fh - r);
            ctx.quadraticCurveTo(fx + fw, fy + fh, fx + fw - r, fy + fh);
            ctx.lineTo(fx + r, fy + fh);
            ctx.quadraticCurveTo(fx, fy + fh, fx, fy + fh - r);
            ctx.lineTo(fx, fy + r);
            ctx.quadraticCurveTo(fx, fy, fx + r, fy);
            ctx.closePath();
            ctx.clip();

            ctx.drawImage(img, fx, fy, fw, fh);
            ctx.restore();

            const out = canvas.toDataURL("image/png");
            resolve(out);
          };
          img.src = reader.result;
        };
        reader.readAsDataURL(file);
      });
    }

    async function processAll() {
      const files = document.getElementById("fileInput").files;
      const preview = document.getElementById("preview");
      preview.innerHTML = "";

      const settings = {
        width: parseInt(document.getElementById("width").value),
        height: parseInt(document.getElementById("height").value),
        dpi: parseInt(document.getElementById("dpi").value),
        margin: parseInt(document.getElementById("margin").value),
        radius: parseInt(document.getElementById("radius").value),
        shadowOffset: parseInt(document.getElementById("shadowOffset").value),
        shadowBlur: parseInt(document.getElementById("shadowBlur").value),
        shadowOpacity: parseFloat(document.getElementById("shadowOpacity").value),
        useBg: document.getElementById("useBg").checked,
        bgColor: document.getElementById("bgColor").value,
        blurStrength: parseInt(document.getElementById("blurStrength").value),
        brightnessFactor: parseFloat(document.getElementById("brightnessFactor").value)
      };

      for (let i = 0; i < files.length; i++) {
        const file = files[i];
        const out = await processImage(file, settings);

        const container = document.createElement("div");
        container.className = "flex flex-col items-center";

        const imgTag = document.createElement("img");
        imgTag.src = out;
        imgTag.className = "rounded-lg shadow";
        container.appendChild(imgTag);

        const a = document.createElement("a");
        a.href = out;
        a.download = `processed_${settings.width}x${settings.height}_${file.name.replace(/\.[^/.]+$/, "")}.png`;
        a.innerText = "Download";
        a.className = "mt-2 text-sm text-blue-600 underline";
        container.appendChild(a);

        preview.appendChild(container);
      }
    }
  </script>
</body>
</html>
